---
toc: true
title: Report Hazards 
layout: post
permalink: /hazard/
nav: true
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hazard Reporter</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">

  <div class="max-w-4xl mx-auto p-6">
    <h1 class="text-3xl font-bold text-center mb-4">ðŸš§ Crowdsourced Hazard Alerts</h1>
    
    <div id="map" class="w-full h-96 rounded-lg shadow-lg mb-6"></div>

    <form id="hazardForm" class="bg-white p-4 rounded shadow-md space-y-4">
      <h2 class="text-xl font-semibold">Report a New Hazard</h2>
      <input type="text" id="description" placeholder="Description (e.g. pothole, flooding)" class="w-full p-2 border border-gray-300 rounded" required>
      <input type="number" id="latitude" placeholder="Latitude" class="w-full p-2 border border-gray-300 rounded" required>
      <input type="number" id="longitude" placeholder="Longitude" class="w-full p-2 border border-gray-300 rounded" required>
      <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">Submit Hazard</button>
    </form>

    <p id="responseMessage" class="mt-4 text-center text-green-600"></p>
  </div>

  <script type="module">
    // âœ… HARDCODED CONFIG
    const pythonURI = "https://autonomous.stu.nighthawkcodingsociety.com";
    const fetchOptions = {
      method: "GET",
      headers: {
        "Content-Type": "application/json"
      },
      credentials: "include"
    };

    const map = L.map('map').setView([32.9628, -117.0359], 13); // Poway center
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    // âœ… LOAD ALL HAZARDS
    async function loadHazards() {
      try {
        const res = await fetch(`${pythonURI}/api/hazards`, fetchOptions);
        if (!res.ok) throw new Error(`Status ${res.status}`);
        const data = await res.json();
        data.forEach(hazard => {
          const { latitude, longitude, description } = hazard;
          L.marker([latitude, longitude])
            .addTo(map)
            .bindPopup(`<strong>Hazard:</strong> ${description}`);
        });
      } catch (err) {
        console.error("Error loading hazards:", err);
        document.getElementById("responseMessage").textContent = "Error loading hazards. Try again later.";
      }
    }

    loadHazards();

    // âœ… REPORT NEW HAZARD
    document.getElementById("hazardForm").addEventListener("submit", async e => {
      e.preventDefault();
      const lat = parseFloat(document.getElementById("latitude").value);
      const lng = parseFloat(document.getElementById("longitude").value);
      const description = document.getElementById("description").value;

      try {
        const res = await fetch(`${pythonURI}/api/hazards`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          credentials: "include",
          body: JSON.stringify({ latitude: lat, longitude: lng, description })
        });

        if (!res.ok) {
          const errText = await res.text();
          throw new Error(`HTTP ${res.status}: ${errText}`);
        }

        document.getElementById("responseMessage").textContent = "Hazard submitted successfully!";
        L.marker([lat, lng])
          .addTo(map)
          .bindPopup(`<strong>Hazard:</strong> ${description}`)
          .openPopup();
        document.getElementById("hazardForm").reset();
      } catch (err) {
        console.error("Error reporting hazard:", err);
        document.getElementById("responseMessage").textContent = "Error submitting hazard.";
      }
    });
  </script>
</body>
</html>
